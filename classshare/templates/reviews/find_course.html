{% extends "base.html" %}

{% load static %}
{% get_static_prefix as STATIC_PREFIX %}

{% block js %}
    {{ block.super }}
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script src="{{ STATIC_PREFIX }}js/isotope.js"></script>
    <script>
  $(document).ready(function() {
    $("#accordion").accordion();
  });
    </script>
{% endblock js %}

{% block css %}
{{ block.super }}
<link href="{{ STATIC_PREFIX }}css/isotope.css" rel="stylesheet" type="text/css" />
<link href="{{ STATIC_PREFIX }}css/course-finder.css" rel="stylesheet" type="text/css" />
{% endblock css %}

{% block content %}

<h2>Find a class:</h2>

<div id="facet-search">
    <h3>Filter by:</h3>
    <div id="accordion">
        <h3><a href="#">Department</a></h3>
        <div class="filters">
            <ul>
            {% for department in departments %}
            <li id="dept-{{ department.abb }}-filter"><a href="#" data-filter=".dept-{{ department.abb }}"><img src="{{ STATIC_PREFIX }}img/icon_addlink.gif" /> {{ department.name }}</a></li>
            {% endfor %}
            </ul>
        </div>
        <h3><a href="#">Tag</a></h3>
        <div class="filters">
            <ul>
            {% for tag in tags %}
            <li id="tag-{{ tag.name }}-filter"><a href="#" data-filter=".tag-{{ tag.name }}">{{ tag.name }}</a></li>
            {% endfor %}
            </ul>
        </div>
    </div>
</div>

<ul id="course-list">
    {% for course in courses %}
    <li class="course dept-{{ course.department.abb }} {% for tag in course.class_set.review_set.tags.all %}tag-{{ tag.name }} {% endfor %}{% if course.class_set.review_set.all.length > 0 %}is-reviewed{% endif %}">
      <div class="course-header">
	      <div class="course-title"><a href="{% url course course.pk %}">{{ course.course_code }}:  {{ course.name }}</a></div>
	      &nbsp;
	      <div class="course-stats">({{ course.review_count }} reviews) <span class="thumbs-up">({{ course.thumbs_count }} <img src="{{ STATIC_PREFIX }}img/Thumbs-up-icon.png" height="30" />)</span></div>
	  </div>
	  {% if course.description %}
	  <div class="course-description">{{ course.description|linebreaks|truncatewords:50 }}</div>
	  {% endif %}
	</li>
    {% endfor %}
</ul>

<script>
      var $container = $('#course-list');

      $container.isotope({
        itemSelector : '.course'
      });
      
      $('.filters a').click(function(){
          var selector = $(this).attr('data-filter');
          $container.isotope({ filter: selector });
          return false;
      });
</script>

{% endblock content %}
